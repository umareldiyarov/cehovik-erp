<!DOCTYPE html>
<html lang="ru">
<head>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–¶–ï–•–û–í–ò–ö ERP</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">


    <style>
        :root {
            --primary: #0071E3; --bg: #F5F5F7; --card: #FFFFFF; --text: #1D1D1F;
            --secondary: #86868B; --danger: #FF453A; --success: #30D158; --border: #D2D2D7;
        }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 90px; }

        .app-header {
            background: var(--card); padding: 15px; border-bottom: 1px solid var(--border);
            position: sticky; top: 0; z-index: 100; display: flex; align-items: center; justify-content: center;
        }
        .btn-back { position: absolute; left: 15px; background: none; border: none; color: var(--primary);
        font-size: 20px; cursor: pointer; padding: 5px; display: none; }
        .app-header h1 { margin: 0; font-size: 16px; color: var(--primary); font-weight: 700; }

        .view-container { padding: 12px; max-width: 600px; margin: 0 auto; }
        .step-content { display: none; }
        .step-content.active { display: block; }

        .card { background: var(--card); border-radius: 16px; padding: 15px; margin-bottom: 15px; border: 1px solid rgba(0,0,0,0.05); }
        .card-h { font-weight: 700; font-size: 14px; margin-bottom: 12px;
        display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--bg); padding-bottom: 8px; }

        .label { font-size: 10px; font-weight: 700; color: var(--secondary); text-transform: uppercase; margin-bottom: 4px; display: block; }
        input, select { width: 100%; border: 1px solid var(--border); border-radius: 8px; padding: 10px; font-size: 14px; outline: none; background: #fff; }
        input:focus { border-color: var(--primary); }
        input.loss-warning { border-color: var(--danger); background: #fff5f5; color: var(--danger); }

        .row-item { display: grid; gap: 8px; margin-bottom: 15px; padding: 12px; background: #f9f9fb; border-radius: 12px; position: relative; align-items: start; }
        .btn-del { background: none; border: none; color: var(--danger); font-size: 20px; cursor: pointer; }
        .btn-add { background: var(--bg); color: var(--primary); border: none; padding: 6px 12px; border-radius: 10px; font-weight: 600; font-size: 11px; }

        .nav-bar { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; display: flex; border-top: 1px solid var(--border); padding: 10px 5px 25px; z-index: 1000; }
        .nav-item { flex: 1; border: none; background: none; display: flex; flex-direction: column; align-items: center; color: var(--secondary); font-size: 10px; font-weight: 600; }
        .nav-item.active { color: var(--primary); }
        .nav-item span { font-size: 20px; }

        .btn-next { background: var(--primary); color: white; border: none; width: 100%; padding: 16px; border-radius: 12px; font-weight: 700; margin-top: 10px; }
        .price-som-badge { font-size: 11px; color: var(--primary); font-weight: 700; display: block; margin-top: 4px; min-height: 14px; }

        .summary-card { background: #1c1c1e; color: white; border-radius: 20px; padding: 20px; }
        .profit-val { font-size: 32px; font-weight: 800; color: var(--success); display: block; text-align: center; margin: 15px 0; }
        .sum-item { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #38383a; font-size: 13px; }

        .buy-title { font-size: 12px; color: var(--primary); font-weight: 700; margin-top: 15px; margin-bottom: 5px; text-transform: uppercase; border-bottom: 1px solid #38383a; padding-bottom: 3px; }
        .buy-row { display: flex; justify-content: space-between; font-size: 12px; padding: 4px 0; opacity: 0.9; }

        /* –£–ª—É—á—à–µ–Ω–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –∏–Ω—Ñ–æ-–±–ª–æ–∫–∞ */
.author-info {
    margin-top: 25px;
    padding: 18px;
    background: #fff;
    border-radius: 16px;
    border: 1px solid var(--border);
    font-size: 13px;
    color: var(--text);
    line-height: 1.6;
}
.author-info h3 { margin-top: 0; color: var(--primary); font-size: 15px; display: flex; align-items: center; gap: 8px; }
.author-info p { margin: 8px 0; }
.info-card { background: #f0f7ff; padding: 10px; border-radius: 10px; margin: 10px 0; border-left: 4px solid var(--primary); }
.author-link {
    display: inline-block;
    margin-top: 10px;
    background: #25D366;
    color: white;
    padding: 10px 15px;
    border-radius: 10px;
    text-decoration: none;
    font-weight: 600;
    text-align: center;
    width: 100%;
}
    </style>
</head>
<body>

<header class="app-header">
    <button class="btn-back" id="btn-back" onclick="goBack()">‚Üê</button>
    <h1 id="step-title">–®–∞–≥ 1: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–∫–∞–∑–∞</h1>
</header>

<div class="view-container" id="tech-card">

    <div id="step-1" class="step-content active">
        <div class="card">
            <div class="card-h">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã</div>
            <div><label class="label">–ù–∞–∑–≤–∞–Ω–∏–µ –º–æ–¥–µ–ª–∏</label><input type="text" id="m_name" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ"></div>
        </div>
        <button onclick="clearData()" style="background: var(--danger); color: white; border: none; padding: 12px; border-radius: 12px; margin-bottom: 15px; width: 100%; font-weight: bold; cursor: pointer;">
    üóë –û—á–∏—Å—Ç–∏—Ç—å –≤–µ—Å—å —Ä–∞—Å—á–µ—Ç
        </button>
        <button class="btn-next" onclick="goToStep(2)">–î–∞–ª–µ–µ: –¢–∫–∞–Ω–∏</button>

        <div class="author-info">
    <h3><span style="font-size:20px;">üí°</span> –ü–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã:</h3>

    <p>–°–∏—Å—Ç–µ–º–∞ <b>¬´–¶–ï–•–û–í–ò–ö ERP¬ª</b> –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç—Å—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ —à–≤–µ–π–Ω–æ–≥–æ –±–∏–∑–Ω–µ—Å–∞.</p>

    <div class="info-card">
        <b>–í–∞–ª—é—Ç–∞:</b> –ï—Å–ª–∏ –≤—ã –ø–æ–∫—É–ø–∞–µ—Ç–µ —Ç–∫–∞–Ω—å –≤ –¥–æ–ª–ª–∞—Ä–∞—Ö, —É–∫–∞–∑—ã–≤–∞–π—Ç–µ –∫—É—Ä—Å, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É –≤—ã –µ—ë —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏–æ–±—Ä–µ–ª–∏.
    </div>

    <div class="info-card">
        <b>–í—ã–ø–∞–¥ %:</b> –£—á–µ—Ç –æ–±—Ä–µ–∑–∫–æ–≤ –∏ –±—Ä–∞–∫–∞ —Ç–∫–∞–Ω–∏.
        <ul style="padding-left: 20px; margin: 5px 0;">
            <li>–ï—Å–ª–∏ —Ä–∞—Å—Ö–æ–¥ —Ç–æ—á–Ω—ã–π ‚Äî —Å—Ç–∞–≤—å—Ç–µ <b>0</b>.</li>
            <li>–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∑–∞–ø–∞—Å ‚Äî <b>5-7%</b>.</li>
        </ul>
    </div>

    <p style="font-size: 11px; color: var(--secondary); font-style: italic;">
        –ú—ã —Å—Ç–∞—Ä–∞–µ–º—Å—è —Å–¥–µ–ª–∞—Ç—å —Ä–∞—Å—á–µ—Ç—ã —Ç–æ—á–Ω—ã–º–∏, –æ–¥–Ω–∞–∫–æ –∞–≤—Ç–æ—Ä –Ω–µ –Ω–µ—Å–µ—Ç –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∑–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ü–∏—Ñ—Ä—ã.
                                                                                                                        –ê–≤—Ç–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞: –£–º–∞—Ä –≠–ª–¥–∏—è—Ä–æ–≤
    </p>

    <p><b>–ù–∞—à–ª–∏ –±–∞–≥ –∏–ª–∏ –µ—Å—Ç—å –∏–¥–µ—è?</b> –ü–∏—à–∏—Ç–µ –Ω–∞–º:</p>
    <a href="https://wa.me/996502516726" class="author-link">
        üí¨ –ù–∞–ø–∏—Å–∞—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É (WhatsApp)
    </a>
</div>


    </div>



    <div id="step-2" class="step-content">
        <div class="card">
            <div class="card-h">–¢–∫–∞–Ω–∏ –∏ –ü–æ–¥–∫–ª–∞–¥ <button class="btn-add" onclick="addFabric()">+ –î–æ–±–∞–≤–∏—Ç—å</button></div>
            <div id="fabric-list"></div>
        </div>
        <button class="btn-next" onclick="goToStep(3)">–î–∞–ª–µ–µ: –ö–ª–µ–µ–≤—ã–µ</button>
    </div>

    <div id="step-3" class="step-content">
        <div class="card">
            <div class="card-h">–ö–ª–µ–µ–≤—ã–µ <button class="btn-add" onclick="addGlue()">+ –î–æ–±–∞–≤–∏—Ç—å</button></div>
            <div id="glue-list"></div>
        </div>
        <button class="btn-next" onclick="goToStep(4)">–î–∞–ª–µ–µ: –§—É—Ä–Ω–∏—Ç—É—Ä–∞</button>
    </div>

    <div id="step-4" class="step-content">
        <div class="card">
            <div class="card-h">–§—É—Ä–Ω–∏—Ç—É—Ä–∞ <button class="btn-add" onclick="addAcc()">+ –î–æ–±–∞–≤–∏—Ç—å</button></div>
            <div id="acc-list"></div>
        </div>
        <button class="btn-next" onclick="goToStep(5)">–î–∞–ª–µ–µ: –¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã</button>
    </div>

    <div id="step-5" class="step-content">
        <div class="card">
            <div class="card-h">–û–ø–ª–∞—Ç–∞ –∑–∞ —Ä–∞–±–æ—Ç—É (1 –µ–¥.)</div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div><label class="label">–ö—Ä–æ–π</label><input type="number" class="fot-in" oninput="calc()"></div>
                <div><label class="label">–ü–æ—à–∏–≤</label><input type="number" class="fot-in" oninput="calc()"></div>
                <div><label class="label">–£—Ç—é–≥ (–≤—Ç–æ)</label><input type="number" class="fot-in" oninput="calc()"></div>
                <div><label class="label">–û–¢–ö / –ß–∏—Å—Ç–∫–∞</label><input type="number" class="fot-in" oninput="calc()"></div>
                <div><label class="label">–£–ø–∞–∫–æ–≤–∫–∞ / –ú–∞—Ä–∫–∏—Ä–æ–≤–∫–∞</label><input type="number" class="fot-in" oninput="calc()"></div>
                <div><label class="label">–ü–µ—Ç–ª–∏ / –ü—É–≥–æ–≤–∏—Ü—ã</label><input type="number" class="fot-in" oninput="calc()"></div>
                <div><label class="label">–¢–µ—Ö–Ω–æ–ª–æ–≥</label><input type="number" class="fot-in" oninput="calc()"></div>
                <div><label class="label">–î–æ–ø. –æ–ø–µ—Ä–∞—Ü–∏–∏ (–†–µ–∑–µ—Ä–≤)</label><input type="number" class="fot-in" oninput="calc()"></div>
            </div>
            <div style="margin-top: 15px; padding-top: 10px; border-top: 1px solid var(--bg); display: flex; justify-content: space-between; align-items: center;">
                <span class="label" style="margin:0">–ò—Ç–æ–≥–æ —Ä–∞–±–æ—Ç—ã (–Ω–∞ 1 –µ–¥):</span>
                <b id="fot-total-badge" style="color: var(--primary); font-size: 16px;">0 —Å–æ–º</b>
            </div>
        </div>
        <button class="btn-next" onclick="goToStep(6)">–î–∞–ª–µ–µ: –ù–∞–ª–æ–≥–∏ –∏ –¶–µ—Ö</button>
    </div>

    <div id="step-6" class="step-content">
        <div class="card">
            <div class="card-h">–†–∞—Å—Ö–æ–¥—ã –∏ –ù–∞–ª–æ–≥–∏</div>
            <label class="label">–ù–∞–ª–æ–≥ —Å –æ–±–æ—Ä–æ—Ç–∞</label>
            <select id="tax_rate" onchange="calc()" style="margin-bottom: 15px;">
                <option value="0.0025">0.25% (–õ—å–≥–æ—Ç–Ω—ã–π)</option>
                <option value="0">0%</option>
                <option value="0.04">4%</option>
            </select>
            <label class="label">–†–∞—Å—Ö–æ–¥—ã —Ü–µ—Ö–∞ (–Ω–∞ 1 –µ–¥.)</label>
            <input type="number" id="fixed_exp" oninput="calc()">
        </div>
        <button class="btn-next" onclick="goToStep(7)">–î–∞–ª–µ–µ: –¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏</button>
    </div>

    <div id="step-7" class="step-content">
        <div class="card">
            <div class="card-h">–£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ü–µ–Ω—ã</div>
            <div style="background: #f0f7ff; padding: 12px; border-radius: 8px; margin-bottom: 15px; text-align: center;">
                <div style="font-size: 11px; color: var(--secondary); margin-bottom: 2px;">–†–ê–°–ß–ï–¢–ù–ê–Ø –°–ï–ë–ï–°–¢–û–ò–ú–û–°–¢–¨</div>
                <div id="monitor_cost" style="font-size: 20px; font-weight: 800; color: var(--text);">0 —Å–æ–º</div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                <div><label class="label">–í–∞–ª—é—Ç–∞ –ø—Ä–æ–¥–∞–∂–∏</label>
                    <select id="cl_curr" onchange="toggleClientRate(); calc()">
                        <option value="KGS">KGS (—Å–æ–º)</option>
                        <option value="USD">USD ($)</option>
                        <option value="RUB">RUB (‚ÇΩ)</option>
                    </select>
                </div>
                <div><label class="label">–ö—É—Ä—Å (—Å–æ–º –∑–∞ 1 –µ–¥.)</label><input type="number" id="cl_rate" value="1" disabled oninput="calc()" placeholder="–ö—É—Ä—Å"></div>
                <div><label class="label">–ü–∞—Ä—Ç–∏—è (—à—Ç)</label><input type="number" id="qty" placeholder="0" oninput="calc()"></div>
                <div><label class="label">–û–ø—Ç–æ–≤–∞—è —Ü–µ–Ω–∞ (<span id="cl_curr_label">KGS</span>)</label><input type="number" id="price_cl_val" placeholder="–¶–µ–Ω–∞ –µ–¥." oninput="calc()"></div>
            </div>
            <div id="cl_price_sub" style="margin-top:15px; font-size:12px; font-weight:600; color:var(--primary); line-height: 1.4;"></div>
        </div>
        <button class="btn-next" onclick="goToStep(8)" style="background:var(--success)">–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –∏—Ç–æ–≥</button>
    </div>

    <div id="step-8" class="step-content">
    <div class="summary-card" id="printable-summary" style="background: #1c1c1e; color: white; border-radius: 20px; padding: 20px; font-family: 'Inter', sans-serif;">

        <div style="text-align: center; border-bottom: 1px solid #38383a; padding-bottom: 15px; margin-bottom: 15px;">
            <div style="font-size: 10px; color: #0071E3; font-weight: 700; margin-bottom: 5px;">
                ID: <span id="res_id">000000</span> | <span id="res_date_full">-</span>
            </div>
            <div id="res_m_name" style="font-size: 22px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px;">-</div>
            <div style="font-size: 13px; color: #86868b; margin-top: 5px;">–ü–∞—Ä—Ç–∏—è: <b id="res_qty" style="color:white">0 —à—Ç</b></div>
        </div>

        <div style="background: rgba(48, 209, 88, 0.1); border-radius: 16px; padding: 15px; text-align: center; margin-bottom: 20px; border: 1px solid rgba(48, 209, 88, 0.2);">
            <div style="font-size: 11px; color: #30D158; text-transform: uppercase; font-weight: 700; margin-bottom: 5px;">–ß–∏—Å—Ç–∞—è –ø—Ä–∏–±—ã–ª—å —Ü–µ—Ö–∞</div>
            <div id="res_profit" style="font-size: 32px; font-weight: 800; color: #30D158;">0 —Å–æ–º</div>
            <div style="font-size: 12px; margin-top: 8px; opacity: 0.8;">
                –°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å 1 –µ–¥: <b id="res_unit_cost" style="color:white">0 —Å–æ–º</b>
            </div>
        </div>

        <div class="buy-title" style="color:#0071E3; border-bottom: 1px solid #38383a; font-size: 11px; padding-bottom: 5px; margin-bottom: 10px;">1. –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏</div>
        <div class="sum-item"><span>–û–±—â–∞—è –≤—ã—Ä—É—á–∫–∞:</span><b id="res_revenue">0 —Å–æ–º</b></div>
        <div class="sum-item"><span>–û–±—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã:</span><b id="res_total_exp">0 —Å–æ–º</b></div>
        <div class="sum-item"><span>–ù–∞–ª–æ–≥:</span><b id="res_tax" style="color:#FF453A">0 —Å–æ–º</b></div>
        <div class="sum-item" style="font-size:11px; color:#86868b; border:none;"><span>–ö—É—Ä—Å —Å–¥–µ–ª–∫–∏:</span><b id="res_rate_val">-</b></div>

        <div class="buy-title" style="color:#0071E3; border-bottom: 1px solid #38383a; font-size: 11px; padding-bottom: 5px; margin-top: 15px; margin-bottom: 10px;">2. –ó–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –ø–∞—Ä—Ç–∏—é</div>
        <div id="res_fabric_consumption_list"></div>

        <div class="sum-item"><span>–¢–∫–∞–Ω–∏ –∏ –ø–æ–¥–∫–ª–∞–¥:</span><b id="res_sum_fabrics">0 —Å–æ–º</b></div>
        <div class="sum-item"><span>–ö–ª–µ–µ–≤—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:</span><b id="res_sum_glues">0 —Å–æ–º</b></div>
        <div class="sum-item"><span>–í—Å—è —Ñ—É—Ä–Ω–∏—Ç—É—Ä–∞:</span><b id="res_sum_accs">0 —Å–æ–º</b></div>
        <div class="sum-item"><span>–†–∞–±–æ—Ç–∞ (–§–û–¢):</span><b id="res_sum_fot">0 —Å–æ–º</b></div>

        <div id="res_detailed_materials"></div>
    </div>


    <button class="btn-next" onclick="shareWhatsApp()" style="background: #25D366; margin-bottom: 20px;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ WhatsApp üí¨</button>
</div>

</div>

<nav class="nav-bar">
    <button class="nav-item active" onclick="goToStep(1)"><span>üìã</span>–ó–∞–∫–∞–∑</button>
    <button class="nav-item" onclick="goToStep(2)"><span>‚úÇÔ∏è</span>–ú–∞—Ç–µ—Ä–∏–∞–ª</button>
    <button class="nav-item" onclick="goToStep(5)"><span>ü™°</span>–§–û–¢</button>
    <button class="nav-item" onclick="goToStep(7)"><span>üí∞</span>–¶–µ–Ω–∞</button>
    <button class="nav-item" onclick="goToStep(8)"><span>üìä</span>–ò—Ç–æ–≥</button>
</nav>

<script>
    let currentStep = 1;
    const titles = ["–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–∫–∞–∑–∞", "–¢–∫–∞–Ω–∏ –∏ –ü–æ–¥–∫–ª–∞–¥", "–ö–ª–µ–µ–≤—ã–µ", "–§—É—Ä–Ω–∏—Ç—É—Ä–∞", "–¢—Ä—É–¥–æ–∑–∞—Ç—Ä–∞—Ç—ã", "–†–∞—Å—Ö–æ–¥—ã —Ü–µ—Ö–∞", "–¶–µ–Ω–∞ –ø—Ä–æ–¥–∞–∂–∏", "–ò—Ç–æ–≥–∏"];

    // 1. –£–õ–£–ß–®–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –°–û–•–†–ê–ù–ï–ù–ò–Ø (—Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–∞–∂–¥—É—é —Å—Ç—Ä–æ—á–∫—É)
    function saveToLocal() {
        const data = {
            m_name: document.getElementById('m_name').value,
            qty: document.getElementById('qty').value,
            cl_price_val: document.getElementById('price_cl_val').value,
            fixed_exp: document.getElementById('fixed_exp').value,
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ —Ç–∫–∞–Ω–∏
            fabrics: Array.from(document.querySelectorAll('.fabric-row')).map(row => ({
                name: row.querySelector('.f-name').value,
                use: row.querySelector('.f-use').value,
                loss: row.querySelector('.f-loss').value,
                curr: row.querySelector('.f-curr').value,
                price: row.querySelector('.f-price').value,
                dav: row.querySelector('.f-dav').checked
            })),
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –∫–ª–µ–µ–≤—ã–µ
            glues: Array.from(document.querySelectorAll('.glue-row')).map(row => ({
                name: row.querySelector('.g-name').value,
                mode: row.querySelector('.g-mode').value,
                price: row.querySelector('.g-price').value,
                roll: row.querySelector('.g-roll-len').value,
                use: row.querySelector('.f-use-cm').value,
                dav: row.querySelector('.g-dav').checked
            })),
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å—é —Ñ—É—Ä–Ω–∏—Ç—É—Ä—É
            accs: Array.from(document.querySelectorAll('.acc-row')).map(row => ({
                name: row.querySelector('.a-name').value,
                unit: row.querySelector('.a-unit').value,
                price: row.querySelector('.a-price').value,
                use: row.querySelector('.a-use').value,
                dav: row.querySelector('.a-dav').checked
            })),
            fot_values: Array.from(document.querySelectorAll('.fot-in')).map(i => i.value)
        };
        localStorage.setItem('cehovik_data', JSON.stringify(data));
    }

    // 2. –£–õ–£–ß–®–ï–ù–ù–ê–Ø –§–£–ù–ö–¶–ò–Ø –ó–ê–ì–†–£–ó–ö–ò (–≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤—Å–µ —Å—Ç—Ä–æ—á–∫–∏)
    function loadFromLocal() {
        const saved = localStorage.getItem('cehovik_data');
        if (!saved) return;
        const data = JSON.parse(saved);

        document.getElementById('m_name').value = data.m_name || '';
        document.getElementById('qty').value = data.qty || '';
        document.getElementById('price_cl_val').value = data.cl_price_val || '';
        document.getElementById('fixed_exp').value = data.fixed_exp || '';

        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–∫–∞–Ω–∏
        if (data.fabrics) {
            document.getElementById('fabric-list').innerHTML = ''; // –æ—á–∏—Å—Ç–∏–º
            data.fabrics.forEach(f => {
                addFabric();
                const row = document.querySelector('#fabric-list .fabric-row:last-child');
                row.querySelector('.f-name').value = f.name;
                row.querySelector('.f-use').value = f.use;
                row.querySelector('.f-loss').value = f.loss;
                row.querySelector('.f-curr').value = f.curr;
                row.querySelector('.f-price').value = f.price;
                row.querySelector('.f-dav').checked = f.dav;
            });
        }

        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–ª–µ–µ–≤—ã–µ
        if (data.glues) {
            document.getElementById('glue-list').innerHTML = '';
            data.glues.forEach(g => {
                addGlue();
                const row = document.querySelector('#glue-list .glue-row:last-child');
                row.querySelector('.g-name').value = g.name;
                row.querySelector('.g-mode').value = g.mode;
                row.querySelector('.g-price').value = g.price;
                row.querySelector('.g-roll-len').value = g.roll;
                row.querySelector('.f-use-cm').value = g.use;
                row.querySelector('.g-dav').checked = g.dav;
            });
        }

        // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ñ—É—Ä–Ω–∏—Ç—É—Ä—É
        if (data.accs) {
            document.getElementById('acc-list').innerHTML = '';
            data.accs.forEach(a => {
                addAcc();
                const row = document.querySelector('#acc-list .acc-row:last-child');
                row.querySelector('.a-name').value = a.name;
                row.querySelector('.a-unit').value = a.unit;
                row.querySelector('.a-price').value = a.price;
                row.querySelector('.a-use').value = a.use;
                row.querySelector('.a-dav').checked = a.dav;
            });
        }

        const fotInputs = document.querySelectorAll('.fot-in');
        if (data.fot_values) {
            data.fot_values.forEach((val, i) => { if (fotInputs[i]) fotInputs[i].value = val; });
        }
        if(typeof calc === "function") calc();
    }

    window.addEventListener('load', loadFromLocal);

    function goToStep(n) {
        currentStep = n;
        document.querySelectorAll('.step-content').forEach(s => s.classList.remove('active'));
        document.getElementById('step-'+n).classList.add('active');
        document.getElementById('step-title').innerText = titles[n-1];
        document.getElementById('btn-back').style.display = n > 1 ? 'block' : 'none';
        document.querySelectorAll('.nav-item').forEach((btn, i) => {
            const stepMapping = [1, 2, 5, 7, 8];
            btn.classList.toggle('active', n === stepMapping[i]);
        });
        window.scrollTo(0,0);
        if(n === 8) calc();
    }

    function goBack() { if (currentStep > 1) goToStep(currentStep - 1); }

    function toggleClientRate() {
        const curr = document.getElementById('cl_curr').value;
        const rateIn = document.getElementById('cl_rate');
        document.getElementById('cl_curr_label').innerText = curr;
        rateIn.disabled = (curr === 'KGS');
        if(curr === 'KGS') { rateIn.value = 1; } else { rateIn.value = ''; rateIn.placeholder = "–í–≤–µ–¥–∏—Ç–µ –∫—É—Ä—Å"; }
        saveToLocal();
    }

    function addFabric() {
        const html = `
        <div class="row-item fabric-row" style="grid-template-columns: repeat(3, 1fr);">
            <div style="grid-column: span 3;"><label class="label">–ù–∞–∑–≤–∞–Ω–∏–µ (–¢–∫–∞–Ω—å/–ü–æ–¥–∫–ª–∞–¥)</label><input type="text" class="f-name" oninput="saveToLocal()"></div>
            <div style="grid-column: span 3;"><label class="label">–†–∞—Å—Ö–æ–¥ (–ú)</label><input type="number" class="f-use" oninput="calc()"></div>
            <div style="grid-column: span 3;"><label class="label">–ë—Ä–∞–∫ –∏ –æ–±—Ä–µ–∑–∫–∏ —Ç–∫–∞–Ω–∏ (–≤—ã–ø–∞–¥ %)</label><input type="number" class="f-loss" oninput="calc()" value="0"></div>
            <div><label class="label">–í–∞–ª—é—Ç–∞</label>
                <select class="f-curr" onchange="toggleFabricRate(this); calc()">
                    <option value="KGS">—Å–æ–º</option><option value="USD">$</option><option value="RUB">‚ÇΩ</option>
                </select>
            </div>
            <div><label class="label">–¶–µ–Ω–∞ (–º)</label><input type="number" class="f-price" oninput="calc()"></div>
            <div><label class="label">–ö—É—Ä—Å –∑–∞ 1$</label><input type="number" class="f-rate" oninput="calc()" value="1" disabled></div>
            <div style="grid-column: span 3;">
                <span class="price-som-badge f-price-som"></span>
                <label class="label">–ò—Ç–æ–≥–æ –Ω–∞ 1 –µ–¥:</label>
                <span class="price-som-badge f-unit-result" style="margin-top:0; font-size:14px; color:var(--text)">0 —Å–æ–º</span>
            </div>
            <div style="grid-column: span 2;"><label class="label"><input type="checkbox" class="f-dav" onchange="calc()"> –î–∞–≤–∞–ª—å—á–µ—Å–∫–æ–µ</label></div>
            <div style="text-align:right;"><button class="btn-del" onclick="this.parentElement.parentElement.remove(); calc()">√ó</button></div>
        </div>`;
        document.getElementById('fabric-list').insertAdjacentHTML('beforeend', html);
    }

    function toggleFabricRate(sel) {
        const row = sel.closest('.fabric-row');
        row.querySelector('.f-rate').disabled = (sel.value === 'KGS');
        if(sel.value === 'KGS') row.querySelector('.f-rate').value = 1;
        saveToLocal();
    }

    function addGlue() {
        const html = `
        <div class="row-item glue-row">
            <div style="grid-column: span 6;"><label class="label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–ª–µ–µ–≤–æ–π</label><input type="text" class="g-name" oninput="saveToLocal()"></div>
            <div style="grid-column: span 6;"><label class="label">–¢–ò–ü –ó–ê–ö–£–ü–ö–ò</label>
                <select class="g-mode" onchange="toggleRoll(this); updateGlueLabels(this); calc()">
                    <option value="m">–ú–µ—Ç—Ä</option><option value="roll">–†—É–ª–æ–Ω</option>
                </select>
            </div>
            <div><label class="label g-price-label">–¶–µ–Ω–∞ –∑–∞ 1 –º–µ—Ç—Ä</label><input type="number" class="g-price" oninput="calc()"></div>
            <div><label class="label">–ú–µ—Ç—Ä–æ–≤ –≤ —Ä—É–ª–æ–Ω–µ</label><input type="number" class="g-roll-len" oninput="calc()" disabled></div>
            <div><label class="label g-use-label">–†–∞—Å—Ö–æ–¥ –Ω–∞ 1 –µ–¥. (—Å–º)</label><input type="number" class="f-use-cm" oninput="calc()"></div>
            <div><button class="btn-del" onclick="this.parentElement.parentElement.remove(); calc()">√ó</button></div>
            <div style="grid-column: span 6;">
                <label class="label">–ò—Ç–æ–≥–æ –Ω–∞ 1 –µ–¥:</label>
                <span class="price-som-badge g-unit-result" style="margin-top:0; font-size:14px; color:var(--text)">0 —Å–æ–º</span>
            </div>
            <div style="grid-column: span 6;"><label class="label"><input type="checkbox" class="g-dav" onchange="calc()"> –î–∞–≤–∞–ª—å—á–µ—Å–∫–æ–µ</label></div>
        </div>`;
        document.getElementById('glue-list').insertAdjacentHTML('beforeend', html);
    }

    function updateGlueLabels(sel) {
        const row = sel.closest('.glue-row');
        row.querySelector('.g-price-label').innerText = sel.value === 'm' ? "–¶–µ–Ω–∞ –∑–∞ 1 –º–µ—Ç—Ä (—Å–æ–º)" : "–¶–µ–Ω–∞ –∑–∞ —Ä—É–ª–æ–Ω (—Å–æ–º)";
    }

    function toggleRoll(sel) { sel.closest('.glue-row').querySelector('.g-roll-len').disabled = (sel.value === 'm'); saveToLocal(); }

    function addAcc() {
        const html = `
        <div class="row-item acc-row">
            <div style="grid-column: span 6;"><label class="label">–§—É—Ä–Ω–∏—Ç—É—Ä–∞</label><input type="text" class="a-name" oninput="saveToLocal()"></div>
            <div style="grid-column: span 6;"><label class="label">–¢–∏–ø</label>
                <select class="a-unit" onchange="updateAccLabels(this); calc()">
                    <option value="—à—Ç">—à—Ç</option>
                    <option value="–º">–º</option>
                </select>
            </div>
            <div style="grid-column: span 3;">
                <label class="label a-price-label">–¶–µ–Ω–∞ –∑–∞ 1 —à—Ç (—Å–æ–º)</label>
                <input type="number" class="a-price" oninput="calc()">
            </div>
            <div style="grid-column: span 3;">
                <label class="label a-use-label">–ö–æ–ª-–≤–æ (–Ω–∞ 1 –µ–¥)</label>
                <input type="number" class="a-use" oninput="calc()">
            </div>
            <div style="grid-column: span 6; margin-top:5px;">
                <label class="label">–ò—Ç–æ–≥–æ –Ω–∞ 1 –µ–¥:</label>
                <span class="price-som-badge a-unit-result" style="margin-top:0; font-size:14px; color:var(--text)">0 —Å–æ–º</span>
            </div>
            <div style="grid-column: span 5;"><label class="label"><input type="checkbox" class="a-dav" onchange="calc()"> –î–∞–≤–∞–ª—å—á–µ—Å–∫–æ–µ</label></div>
            <div style="text-align:right;"><button class="btn-del" onclick="this.parentElement.parentElement.remove(); calc()">√ó</button></div>
        </div>`;
        document.getElementById('acc-list').insertAdjacentHTML('beforeend', html);
    }

    function updateAccLabels(sel) {
        const row = sel.closest('.acc-row');
        row.querySelector('.a-price-label').innerText = sel.value === '—à—Ç' ? "–¶–µ–Ω–∞ –∑–∞ 1 —à—Ç (—Å–æ–º)" : "–¶–µ–Ω–∞ –∑–∞ 1 –º–µ—Ç—Ä (—Å–æ–º)";
        saveToLocal();
    }

    function calc() {
        saveToLocal();
        const qty = parseFloat(document.getElementById('qty').value) || 0;
        const taxRate = parseFloat(document.getElementById('tax_rate').value);
        const fixedExp = parseFloat(document.getElementById('fixed_exp').value) || 0;
        const clPriceVal = parseFloat(document.getElementById('price_cl_val').value) || 0;
        const clRate = parseFloat(document.getElementById('cl_rate').value) || 1;
        const clCurr = document.getElementById('cl_curr').value;
        const mName = document.getElementById('m_name').value || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';

        let totalFabricsUnit = 0;
        let totalGluesUnit = 0;
        let totalAccsUnit = 0;

        const now = new Date();
        document.getElementById('res_date_full').innerText = now.toLocaleString('ru-RU');
        document.getElementById('res_id').innerText = Math.floor(Math.random() * 900000) + 100000;
        let fabricConsumHTML = '';
        let materialsHTML = `
            <div class="buy-title" style="margin-top:20px; color: #0071E3; border-bottom: 2px solid #0071E3;">3. –î–ï–¢–ê–õ–¨–ù–´–ô –†–ê–°–•–û–î –ú–ê–¢–ï–†–ò–ê–õ–û–í</div>
            <table style="width:100%; border-collapse: collapse; font-size: 12px; margin-top: 10px; color: white;" id="materials-table">
                <thead>
                    <tr style="border-bottom: 2px solid #38383a; text-align: left; color: #86868b;">
                        <th style="padding: 8px 4px;">–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ</th>
                        <th style="padding: 8px 4px; text-align: center;">–ù–∞ 1 –µ–¥.</th>
                        <th style="padding: 8px 4px; text-align: right;">–í—Å–µ–≥–æ –Ω–∞ –ø–∞—Ä—Ç–∏—é</th>
                    </tr>
                </thead>
                <tbody>
        `;
        document.querySelectorAll('.fabric-row').forEach(row => {
            const name = row.querySelector('.f-name').value || '–¢–∫–∞–Ω—å';
            const p = parseFloat(row.querySelector('.f-price').value) || 0;
            const r = parseFloat(row.querySelector('.f-rate').value) || 1;
            const u = parseFloat(row.querySelector('.f-use').value) || 0;
            const lVal = parseFloat(row.querySelector('.f-loss').value) || 0;
            const l = 1 + (lVal / 100);
            const isDav = row.querySelector('.f-dav').checked;
            const curr = row.querySelector('.f-curr').value;
            const resBadge = row.querySelector('.f-unit-result');
            const somBadge = row.querySelector('.f-price-som');

            if (curr !== 'KGS' && p > 0 && r > 1) {
                somBadge.innerText = (p * r).toFixed(1) + ' —Å–æ–º/–º';
            } else {
                somBadge.innerText = '';
            }
            const costUnit = p * r * u * l;
            resBadge.innerText = costUnit.toFixed(2) + ' —Å–æ–º';
            if (u > 0) {
                if(!isDav) totalFabricsUnit += costUnit;
                fabricConsumHTML += `<div class="sum-item"><span>${name} (—Ä–∞—Å—Ö–æ–¥):</span><b style="color:var(--primary)">${(u * l).toFixed(2)} –º / –µ–¥</b></div>`;
                materialsHTML += `
                    <tr style="border-bottom: 1px solid #2c2c2e;">
                        <td style="padding: 10px 4px;">
                            <b style="color:#fff;">${name}</b>${isDav ? ' <i style="color:#86868b;">(–î–∞–≤.)</i>' : ''}
                            <br><span style="font-size:10px; color:#86868b;">–ë—Ä–∞–∫: ${lVal}%</span>
                        </td>
                        <td style="padding: 10px 4px; text-align: center; color:#ccc;">${(u * l).toFixed(2)} –º</td>
                        <td style="padding: 10px 4px; text-align: right; color:#0071E3; font-weight:700;">${(u * l * qty).toFixed(1)} –º</td>
                    </tr>`;
            }
        });

        document.querySelectorAll('.glue-row').forEach(row => {
            const name = row.querySelector('.g-name').value || '–ö–ª–µ–µ–≤–∞—è';
            const mode = row.querySelector('.g-mode').value;
            const p = parseFloat(row.querySelector('.g-price').value) || 0;
            const rL = parseFloat(row.querySelector('.g-roll-len').value) || 1;
            const u = parseFloat(row.querySelector('.f-use-cm').value) || 0;
            const isDav = row.querySelector('.g-dav').checked;
            const resBadge = row.querySelector('.g-unit-result');
            const priceM = (mode === 'roll') ? (p/rL) : p;
            const finalUnitCost = (priceM * (u/100));
            resBadge.innerText = finalUnitCost.toFixed(2) + ' —Å–æ–º';
            if (u > 0) {
                if(!isDav) totalGluesUnit += finalUnitCost;
                materialsHTML += `
                    <tr style="border-bottom: 1px solid #2c2c2e;">
                        <td style="padding: 10px 4px;">${name}${isDav ? ' (–î–∞–≤.)' : ''}</td>
                        <td style="padding: 10px 4px; text-align: center; color:#ccc;">${u} —Å–º</td>
                        <td style="padding: 10px 4px; text-align: right; font-weight:700;">${((u/100) * qty).toFixed(1)} –º</td>
                    </tr>`;
            }
        });

        document.querySelectorAll('.acc-row').forEach(row => {
            const name = row.querySelector('.a-name').value || '–§—É—Ä–Ω–∏—Ç—É—Ä–∞';
            const p = parseFloat(row.querySelector('.a-price').value) || 0;
            const u = parseFloat(row.querySelector('.a-use').value) || 0;
            const unit = row.querySelector('.a-unit').value;
            const isDav = row.querySelector('.a-dav').checked;
            const resBadge = row.querySelector('.a-unit-result');
            const costUnit = p * u;
            resBadge.innerText = costUnit.toFixed(2) + ' —Å–æ–º';
            if (u > 0) {
                if(!isDav) totalAccsUnit += costUnit;
                materialsHTML += `
                    <tr style="border-bottom: 1px solid #2c2c2e;">
                        <td style="padding: 10px 4px;">${name}${isDav ? ' (–î–∞–≤.)' : ''}</td>
                        <td style="padding: 10px 4px; text-align: center; color:#ccc;">${u} ${unit}</td>
                        <td style="padding: 10px 4px; text-align: right; font-weight:700;">${(u * qty).toFixed(0)} ${unit}</td>
                    </tr>`;
            }
        });

        materialsHTML += `</tbody></table>`;
        const fotUnit = Array.from(document.querySelectorAll('.fot-in')).reduce((s, i) => s + (parseFloat(i.value) || 0), 0);
        document.getElementById('fot-total-badge').innerText = fotUnit.toFixed(0) + ' —Å–æ–º';
        const totalMatUnit = totalFabricsUnit + totalGluesUnit + totalAccsUnit;
        const unitCost = totalMatUnit + fotUnit + fixedExp;
        const totalExp = unitCost * qty;
        const revenueSom = clPriceVal * clRate * qty;
        const tax = revenueSom * taxRate;
        const profit = revenueSom - totalExp - tax;

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–∞–∑–¥–µ–ª–µ "2. –ó–∞—Ç—Ä–∞—Ç—ã –Ω–∞ –ø–∞—Ä—Ç–∏—é"
        document.getElementById('res_fabric_consumption_list').innerHTML = fabricConsumHTML;

        // –¢–∫–∞–Ω–∏ –∏ –ø–æ–¥–∫–ª–∞–¥
        document.getElementById('res_sum_fabrics').innerHTML =
            `<span style="font-weight:400; color:#86868b; margin-right:10px;">(${Math.round(totalFabricsUnit)} —Å–æ–º/–µ–¥)</span>` +
            `<span>${Math.round(totalFabricsUnit * qty).toLocaleString()} —Å–æ–º</span>`;

        // –ö–ª–µ–µ–≤—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã
        document.getElementById('res_sum_glues').innerHTML =
            `<span style="font-weight:400; color:#86868b; margin-right:10px;">(${Math.round(totalGluesUnit)} —Å–æ–º/–µ–¥)</span>` +
            `<span>${Math.round(totalGluesUnit * qty).toLocaleString()} —Å–æ–º</span>`;

        // –í—Å—è —Ñ—É—Ä–Ω–∏—Ç—É—Ä–∞
        document.getElementById('res_sum_accs').innerHTML =
            `<span style="font-weight:400; color:#86868b; margin-right:10px;">(${Math.round(totalAccsUnit)} —Å–æ–º/–µ–¥)</span>` +
            `<span>${Math.round(totalAccsUnit * qty).toLocaleString()} —Å–æ–º</span>`;

        // –†–∞–±–æ—Ç–∞ (–§–û–¢)
        document.getElementById('res_sum_fot').innerHTML =
            `<span style="font-weight:400; color:#86868b; margin-right:10px;">(${Math.round(fotUnit)} —Å–æ–º/–µ–¥)</span>` +
            `<span>${Math.round(fotUnit * qty).toLocaleString()} —Å–æ–º</span>`;

        const priceInput = document.getElementById('price_cl_val');
        if (clPriceVal > 0 && (clPriceVal * clRate) <= unitCost) { priceInput.classList.add('loss-warning'); } else { priceInput.classList.remove('loss-warning'); }

        // –ë–ª–æ–∫ –≤—ã–≤–æ–¥–∞ –≤ –ò–¢–û–ì–ò (–®–∞–≥ 8)
        document.getElementById('res_m_name').innerText = mName;
        document.getElementById('res_qty').innerText = qty + ' —à—Ç';

        // –ë—ã–ª–æ Math.round(), —Å—Ç–∞–ª–æ .toFixed(2) –¥–ª—è —Ç–æ—á–Ω–æ—Å—Ç–∏
        document.getElementById('monitor_cost').innerText = unitCost.toFixed(2) + ' —Å–æ–º';
        document.getElementById('res_unit_cost').innerText = unitCost.toFixed(2) + ' —Å–æ–º';
        document.getElementById('res_total_exp').innerText = totalExp.toFixed(2) + ' —Å–æ–º';
        document.getElementById('res_revenue').innerText = revenueSom.toFixed(2) + ' —Å–æ–º';
        document.getElementById('res_tax').innerText = tax.toFixed(2) + ' —Å–æ–º';

        let subText = `–í—ã—Ä—É—á–∫–∞: ${(clPriceVal * qty).toFixed(2)} ${clCurr}`;
        if(clCurr !== 'KGS') { subText += ` | –ò—Ç–æ–≥–æ –≤ —Å–æ–º–∞—Ö: ${revenueSom.toFixed(2)} —Å–æ–º`; }
        document.getElementById('cl_price_sub').innerText = clPriceVal > 0 ? subText : "";
        document.getElementById('res_rate_val').innerText = `1 ${clCurr} = ${clRate} —Å–æ–º`;

        const profitEl = document.getElementById('res_profit');
        // –ó–¥–µ—Å—å —Ç–æ–∂–µ —Å—Ç–∞–≤–∏–º .toFixed(2) —á—Ç–æ–±—ã –ø—Ä–∏–±—ã–ª—å –±—ã–ª–∞ —Ç–æ—á–Ω–æ–π
        profitEl.innerText = profit.toFixed(2) + ' —Å–æ–º';
        profitEl.style.color = profit < 0 ? 'var(--danger)' : 'var(--success)';
        document.getElementById('res_detailed_materials').innerHTML = materialsHTML;
    }



    function shareWhatsApp() {
        const mName = document.getElementById('m_name').value || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è';
        const qty = document.getElementById('qty').value || 0;
        const unitCost = document.getElementById('res_unit_cost').innerText;
        const totalExp = document.getElementById('res_total_exp').innerText;
        const revenue = document.getElementById('res_revenue').innerText;
        const tax = document.getElementById('res_tax').innerText;
        const profit = document.getElementById('res_profit').innerText;
        const fixedExpUnit = document.getElementById('fixed_exp').value || 0;
        const date = document.getElementById('res_date_full').innerText;
        let message = `–û–¢–ß–ï–¢: ${mName.toUpperCase()}\n`;
        message += `–î–∞—Ç–∞: ${date}\n`;
        message += `----------------------------\n`;
        message += `–ü–∞—Ä—Ç–∏—è: ${qty} —à—Ç.\n`;
        message += `–°–µ–±–µ—Å—Ç–æ–∏–º–æ—Å—Ç—å 1 –µ–¥: ${unitCost}\n`;
        message += `–û–±—â–∏–µ —Ä–∞—Å—Ö–æ–¥—ã: ${totalExp}\n`;
        message += `–í—ã—Ä—É—á–∫–∞: ${revenue}\n`;
        message += `–ù–∞–ª–æ–≥: ${tax}\n`;
        message += `–ß–ò–°–¢–ê–Ø –ü–†–ò–ë–´–õ–¨: ${profit}\n`;
        message += `----------------------------\n`;
        message += `–î–ï–¢–ê–õ–ò–ó–ê–¶–ò–Ø (–Ω–∞ 1 –µ–¥):\n`;
        message += `‚Ä¢ –†–∞–±–æ—Ç–∞ (–§–û–¢): ${document.getElementById('fot-total-badge').innerText}\n`;
        message += `‚Ä¢ –†–∞—Å—Ö–æ–¥—ã —Ü–µ—Ö–∞: ${fixedExpUnit} —Å–æ–º\n`;
        document.querySelectorAll('.fabric-row').forEach(row => {
            const name = row.querySelector('.f-name').value || '–¢–∫–∞–Ω—å';
            const u = parseFloat(row.querySelector('.f-use').value) || 0;
            const l = 1 + (parseFloat(row.querySelector('.f-loss').value) || 0)/100;
            if (u > 0) message += `‚Ä¢ –†–∞—Å—Ö–æ–¥ ${name}: ${(u * l).toFixed(2)} –º/–µ–¥\n`;
        });
        message += `----------------------------\n`;
        message += `–°–ü–ï–¶–ò–§–ò–ö–ê–¶–ò–Ø –ú–ê–¢–ï–†–ò–ê–õ–û–í (–Ω–∞ –ø–∞—Ä—Ç–∏—é):\n`;
        document.querySelectorAll('.fabric-row').forEach(row => {
            const name = row.querySelector('.f-name').value || '–¢–∫–∞–Ω—å';
            const u = parseFloat(row.querySelector('.f-use').value) || 0;
            const l = 1 + (parseFloat(row.querySelector('.f-loss').value) || 0)/100;
            const p = row.querySelector('.f-price').value || 0;
            const curr = row.querySelector('.f-curr').value;
            const isDav = row.querySelector('.f-dav').checked;
            if (u > 0) message += `‚Ä¢ ${name}: ${(u * l * qty).toFixed(2)} –º. (–¶–µ–Ω–∞: ${p} ${curr}${isDav ? ' - –î–∞–≤–∞–ª—å—á.' : ''})\n`;
        });
        document.querySelectorAll('.glue-row').forEach(row => {
            const name = row.querySelector('.g-name').value || '–ö–ª–µ–µ–≤–∞—è';
            const u = parseFloat(row.querySelector('.f-use-cm').value) || 0;
            const isDav = row.querySelector('.g-dav').checked;
            if (u > 0) message += `‚Ä¢ ${name}: ${((u/100) * qty).toFixed(2)} –º.${isDav ? ' - –î–∞–≤–∞–ª—å—á.' : ''}\n`;
        });
        document.querySelectorAll('.acc-row').forEach(row => {
            const name = row.querySelector('.a-name').value || '–§—É—Ä–Ω–∏—Ç—É—Ä–∞';
            const u = parseFloat(row.querySelector('.a-use').value) || 0;
            const unit = row.querySelector('.a-unit').value;
            const p = row.querySelector('.a-price').value || 0;
            const isDav = row.querySelector('.a-dav').checked;
            if (u > 0) message += `‚Ä¢ ${name}: ${(u * qty).toFixed(0)} ${unit}. (–¶–µ–Ω–∞: ${p} —Å–æ–º${isDav ? ' - –î–∞–≤–∞–ª—å—á.' : ''})\n`;
        });
        const encodedMessage = encodeURIComponent(message);
        window.open(`https://wa.me/?text=${encodedMessage}`, '_blank');
    }

    // –¢–ê –°–ê–ú–ê–Ø –§–£–ù–ö–¶–ò–Ø –û–ß–ò–°–¢–ö–ò
    function clearData() {
        if (confirm("–í—ã —Ç–æ—á–Ω–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞—á–∞—Ç—å –Ω–æ–≤—ã–π —Ä–∞—Å—á–µ—Ç?")) {
            localStorage.removeItem('cehovik_data');
            location.reload();
        }
    }
</script>
</body>
</html>